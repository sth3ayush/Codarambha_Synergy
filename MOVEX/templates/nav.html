{% load static %}

<div id="navbar-container">
    <!-- Top Navbar (Desktop) -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light px-3 fixed-top d-none d-lg-flex"
        style="background-color: #fff !important;">
        <div class="container-fluid">

            <!-- Logo -->
            <a class="navbar-brand fw-bold" href="{% url 'home' %}"><img src="{% static 'images/movex-logo-l.png' %}"
                    alt="MOVEX" style="height: 25px;"></a>

            <!-- Center Links -->
            <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                {% if not hide_nav_icons %}
                    <ul class="navbar-nav d-flex">
                        <li class="nav-item">
                            <a class="nav-link nav-hover active" href="{% url 'home' %}"><i class="bi bi-house me-1" title="Home"></i></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-hover" href="#"><i class="bi bi-geo-alt me-1" title="Map"></i></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-hover" href="#"><i class="bi bi-calendar me-1" title="Booking"></i></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-hover" href="#"><i class="bi bi-headset me-1" title="Support"></i></a>
                        </li>
                    </ul>
                {% endif %}
            </div>

            <!-- Right Section -->
            <div class="d-flex align-items-center">
                {% if user.is_authenticated %}
                    {% if host_profile_exists %}
                        {% if not hide_nav_icons %}
                            <a href="{% url 'hosting' %}" class="me-3">Switch to hosting</a>
                        {% else %}
                            <a href="{% url 'home' %}" class="me-3">Switch to booking</a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'host-profile-create' %}" class="me-3">Become a host</a>
                    {% endif %}
                    {% if user.first_name %}
                        <div class="profile-circle me-3" style="cursor: pointer;">{{ user.first_name|slice:":1"|capfirst }}</div>
                    {% else %}
                        <div class="profile-circle me-3" style="cursor: pointer;">{{ user.email|slice:":1"|capfirst }}</div>
                    {% endif %}
                {% else %}
                    <a href="{% url 'login' %}" class="me-3">Log In</a>
                {% endif %}
                <div class="menu-icon d-none d-lg-flex">
                    <i class="bi bi-list fs-4"></i>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Top Bar -->
    <nav class="navbar navbar-light bg-light px-3 d-lg-none fixed-top" style="background-color: #fff !important;">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <a class="navbar-brand fw-bold" href="{% url 'home' %}"><img src="{% static 'images/movex-logo-l.png' %}" alt="MOVEX"
                    style="height: 25px;"></a>
            <div class="d-flex align-items-center">
                {% if user.is_authenticated %}
                    {% if user.first_name %}
                        <div class="profile-circle me-3" style="cursor: pointer;">{{ user.first_name|slice:":1"|capfirst }}</div>
                    {% else %}
                        <div class="profile-circle me-3" style="cursor: pointer;">{{ user.email|slice:":1"|capfirst }}</div>
                    {% endif %}
                {% else %}
                    <a href="{% url 'login' %}" class="me-3">Log In</a>
                {% endif %}
                <div class="menu-icon">
                    <i class="bi bi-list fs-4"></i>
                </div>
            </div>
        </div>
    </nav>

    <!-- Bottom Navbar (Mobile only) -->
    {% if not hide_nav_icons %}
        <nav class="navbar fixed-bottom bottom-nav d-lg-none">
            <div class="container-fluid d-flex justify-content-around align-items-center">
                <a href="{% url 'home' %}" class="nav-link nav-hover active" title="Home" ><i class="bi bi-house"></i></a>
                <a href="#" class="nav-link nav-hover"><i class="bi bi-geo-alt" title="Map"></i></a>
                <a href="#" class="nav-link nav-hover"><i class="bi bi-calendar" title="Booking"></i></a>
                <a href="#" class="nav-link nav-hover"><i class="bi bi-headset" title="Support"></i></a>
            </div>
        </nav>
    {% endif %}
</div>

<!-- Dropdown Menu (Shared for desktop & mobile) -->
<div class="dropdown-card" id="dropdownMenu">
    {% if not hide_nav_icons %}
        <a href="{% url 'home' %}" class="dropdown-item"><i class="bi bi-house me-1"></i> Home</a>
        <a href="#" class="dropdown-item"><i class="bi bi-geo-alt me-1"></i> Map</a>
        <a href="#" class="dropdown-item"><i class="bi bi-calendar me-1"></i> Booking</a>
        <a href="#" class="dropdown-item"><i class="bi bi-headset me-1"></i> Support</a>

        <div class="dropdown-separator"></div>
        {% if user.is_authenticated %}
            <a href="#" class="dropdown-item"><i class="bi bi-bell"></i> Notifications
                <span class="badge">1</span>
            </a>
            <a href="#" class="dropdown-item"><i class="bi bi-gear"></i> Account settings</a>
            <a href="#" class="dropdown-item"><i class="bi bi-clock-history"></i> History</a>
        {% else %}
            <a href="{% url 'login' %}" class="dropdown-item"><i class="bi bi-person"></i> Login</a>
            <a href="{% url 'register' %}" class="dropdown-item"><i class="bi bi-person-add"></i> Sign Up</a>
        {% endif %}

        {% if user.is_authenticated %}
            <div class="dropdown-separator"></div>
            {% if host_profile_exists %}
                <a href="{% url 'hosting' %}" class="dropdown-item">Switch to hosting</a>
            {% else %}
                <a href="{% url 'host-profile-create' %}" class="dropdown-item">Become a host</a>
            {% endif %}

        <div class="dropdown-separator"></div>
        <a href="{% url 'logout' %}" class="dropdown-item">Log out</a>
        {% endif %}
    {% else %}
        <a href="#" class="dropdown-item"><i class="bi bi-bell"></i> Notifications
            <span class="badge">1</span>
        </a> 
        <a href="#" class="dropdown-item"><i class="bi bi-gear"></i> Account settings</a>
        <a href="#" class="dropdown-item"><i class="bi bi-clock-history"></i> History</a>
        <div class="dropdown-separator"></div>
        <a href="{% url 'home' %}" class="dropdown-item">Switch to booking</a>
        <div class="dropdown-separator"></div>
        <a href="{% url 'logout' %}" class="dropdown-item">Log out</a>
    {% endif %}
</div>

<!-- Profile Card -->
<div class="profile-card" id="profileCard">
    {% if user.is_authenticated %}
        <div class="profile-circle-big">
            {% if user.first_name %}
                {{ user.first_name|slice:":1"|capfirst }}
            {% else %}
                {{ user.email|slice:":1"|capfirst }}
            {% endif %}
        </div>
        {% if user.first_name and user.last_name %}
            <h4>{{user.first_name}} {{user.last_name}}</h4>
        {% else %}
            Guest User
        {% endif %}
        <div class="dropdown-separator"></div>
        <p>Email:<br>{{user.email}}</p>
        <a href="#" class="account-btn">
            <i class="bi bi-gear"></i> Account Setting
        </a>
    {% endif %}
</div>

<script>
    const menuIcons = document.querySelectorAll('.menu-icon'); // catch both desktop + mobile
    const dropdownMenu = document.getElementById('dropdownMenu');

    menuIcons.forEach(icon => {
        icon.addEventListener('click', () => {
            dropdownMenu.classList.toggle('active');
        });
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (event) => {
        if (![...menuIcons].some(icon => icon.contains(event.target)) && !dropdownMenu.contains(event.target)) {
            dropdownMenu.classList.remove('active');
        }
    });

    const profileIcons = document.querySelectorAll('.profile-circle'); // both desktop + mobile
    const profileCard = document.getElementById('profileCard');

    profileIcons.forEach(icon => {
        icon.addEventListener('click', () => {
            profileCard.style.display =
                profileCard.style.display === 'block' ? 'none' : 'block';
        });
    });

    document.addEventListener('click', (event) => {
        if (![...profileIcons].some(icon => icon.contains(event.target)) && !profileCard.contains(event.target)) {
            profileCard.style.display = 'none';
        }
    });

</script>